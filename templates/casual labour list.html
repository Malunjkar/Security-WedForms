<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Casual Labour Register</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/casual_labour.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>

  <header class="header-dashboard">
    <div class="hamburger-dashboard" id="hamburger" style="display:flex;align-items:center;gap:10px;cursor:pointer;">
      ☰
      <a href="{{ url_for('routes_bp.home') }}">
        <img src="{{ url_for('static', filename='img/logo.png') }}" class="logo-dashboard">
      </a>
    </div>

    <h2 style="text-align:center;">Casual Labour Register</h2>

    <div id="profileAvatar" style="display:flex;align-items:center;cursor:pointer;background:#fff;
        padding:6px 10px;border-radius:50px;">

      <div id="profileInitials" style="background:#007bff;color:#fff;width:32px;height:32px;border-radius:50%;
            display:flex;align-items:center;justify-content:center;font-weight:bold;">
        {{ (session.get('user') or {}).get('name','GU')[:2].upper() }}
      </div>

      <span style="margin-left:8px;font-weight:bold;color:black;">
        {{ (session.get('user') or {}).get('name','Guest User') }}
      </span>
    </div>
  </header>


  <div class="container">

    <!-- PAGINATION -->
    <div class="toolbar" id="paginationBar">
      <div class="pagination">
        <button id="prevBtn" onclick="prevPage()">◀ Back</button>
        <span id="pageInfo"></span>
        <button id="nextBtn" onclick="nextPage()">Next ▶</button>
      </div>
    </div>


    <!-- ================= LIST VIEW ================= -->
    <div id="listView">

      <table id="masterTable">
        <thead>
          <tr>
            <th>Location</th>
            <th>Contractor</th>
            <th>Nature of Work</th>
            <th>Place of Work</th>
            <th>Date / Time</th>

            {% if user_role != 'admin' %}
            <th>Action</th>
            {% endif %}

          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="table-footer">

        {% if user_role != 'admin' %}
        <button class="btn-add" onclick="openAddForm()">Add Data</button>
        {% endif %}

        <button class="btn-download" onclick="downloadTable()">
          <i class="fa-solid fa-download"></i> Download
        </button>

      </div>

    </div>


    <!-- ================= STEP 1 ================= -->
    <div id="step1" class="form-box">
      <h3>Work Details</h3>

      <div class="row">
        <div class="field">
          <label for="s_location">Location</label>
          <input id="s_location" value="{{ user_location }}" readonly>
        </div>

        <div class="field">
          <label for="s_contractor_name">Contractor Name</label>
          <input id="s_contractor_name">
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="s_nature_of_work">Nature of Work</label>
          <input id="s_nature_of_work">
        </div>

        <div class="field">
          <label for="s_place_of_work">Place of Work</label>
          <input id="s_place_of_work">
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="dt_work_datetime">Date & Time</label>
          <input type="datetime-local" id="dt_work_datetime">
        </div>
      </div>

    </div>


    <!-- ================= STEP 2 ================= -->
    <div id="step2" class="form-box">
      <h3>Labour Details</h3>

      <div class="row">
        <div class="field">
          <label for="labour_name">Name</label>
          <input id="labour_name" required>
        </div>

        <div class="field">
          <label for="labour_age">Age</label>
          <input id="labour_age" type="number" required>
        </div>

        <div class="field">
          <label for="labour_sex">Sex</label>
          <select id="labour_sex" required>
            <option value="">Select</option>
            <option>Male</option>
            <option>Female</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="labour_address">Address</label>
          <input id="labour_address" required>
        </div>

        <div class="field">
          <label for="labour_card">Temp Card No</label>
          <input id="labour_card" required>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label for="labour_mobile">Mobile</label>
          <input
            id="labour_mobile"
            type="text"
            maxlength="10"
            pattern="[0-9]{10}"
            inputmode="numeric"
            required>
        </div>

        <div class="field">
          <label for="labour_id_type">ID Type</label>
          <select id="labour_id_type" required>
            <option value="">Select</option>
            <option>Aadhar</option>
            <option>PAN</option>
            <option>Driving License</option>
          </select>
        </div>

        <div class="field">
          <label for="labour_id_no">Govt ID No</label>
          <input id="labour_id_no" required>
        </div>
      </div>

      {% if user_role != 'admin' %}
      <button onclick="addLabour()">Add Labour</button>
      {% endif %}

      <table id="labourTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Age</th>
            <th>Sex</th>
            <th>Address</th>
            <th>Mobile</th>

            {% if user_role != 'admin' %}
            <th>Action</th>
            {% endif %}

          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <br>

      {% if user_role != 'admin' %}
      <button class="btn-save" onclick="saveData()">Save</button>
      {% endif %}

    </div>

  </div>

  <script>
      const USER_LOCATION = "{{ user_location }}";
      const USER_ROLE = "{{ user_role }}";
  </script>

  <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="{{ url_for('static', filename='javascript/casual_labour.js') }}"></script>

</body>
</html>
