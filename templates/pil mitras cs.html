<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Pipeline Mitra Register</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/pil_mitras_cs.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>

  <header class="header-dashboard">
    <div class="hamburger-dashboard">
      ☰
      <a href="{{ url_for('routes_bp.home') }}">
        <img src="{{ url_for('static', filename='img/logo.png') }}" class="logo-dashboard">
      </a>
    </div>

    <h2>Pipeline Mitra Register</h2>

    <div id="profileAvatar">
      <div id="profileInitials">
        {{ (session.get('user') or {}).get('name','GU')[:2].upper() }}
      </div>
      <span id="username">
        {{ (session.get('user') or {}).get('name','Guest User') }}
      </span>
    </div>
  </header>

  <div class="toolbar">
    <div class="pagination">
      <button id="prevBtn" onclick="prevPage()">◀ Back</button>
      <span id="pageInfo"></span>
      <button id="nextBtn" onclick="nextPage()">Next ▶</button>
    </div>
  </div>

  <div class="table-wrapper">
    <table id="mitraTable">
      <thead>
        <tr>
          <th>Sr No</th>
          <th>Location</th>
          <th>Date</th>
          <th>Chainage No</th>
          <th>Name of PM</th>
          <th>Village</th>
          <th>Mobile No</th>
          <th>Remarks</th>

          {% if user_role != 'admin' %}
          <th class="action-col">Action</th>
          {% endif %}

        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="table-footer">

    {% if user_role != 'admin' %}
      <button class="btn-add" onclick="addRow()">Add Row</button>
      <button class="btn-save" onclick="saveTable()">Save</button>
    {% endif %}

    <button class="btn-download" onclick="downloadTable()">
        <i class="fa-solid fa-download"></i> Download
    </button>

  </div>

  <!-- ADD ROW TEMPLATE -->
  <template id="mitraAddRowTemplate">
    <tr data-new="true">
      <td class="sr-no"></td>
      <td class="loc"></td>
      <td><input type="date"></td>
      <td><input type="text"></td>
      <td><input type="text"></td>
      <td><input type="text"></td>
      <td><input type="text"></td>
      <td><input type="text"></td>

      {% if user_role != 'admin' %}
      <td class="action-col">
        <button class="icon-btn edit" onclick="editRow(this)">
          <i class="fa-solid fa-pen"></i>
        </button>
        <button class="icon-btn delete" onclick="deleteRow(this)">
          <i class="fa-solid fa-trash"></i>
        </button>
      </td>
      {% endif %}

    </tr>
  </template>

  <!-- VIEW ROW TEMPLATE -->
  <template id="mitraViewRowTemplate">
    <tr>
      <td class="sr-no"></td>
      <td class="loc"></td>
      <td class="date"></td>
      <td class="chainage"></td>
      <td class="name"></td>
      <td class="village"></td>
      <td class="mobile"></td>
      <td class="remarks"></td>

      {% if user_role != 'admin' %}
      <td class="action-col">
        <button class="icon-btn edit" onclick="editRow(this)">
          <i class="fa-solid fa-pen"></i>
        </button>
        <button class="icon-btn delete" onclick="deleteRow(this)">
          <i class="fa-solid fa-trash"></i>
        </button>
      </td>
      {% endif %}

    </tr>
  </template>

  <script>
      const USER_LOCATION = "{{ user_location }}";
      const USER_ROLE = "{{ user_role }}";
  </script>

  <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="{{ url_for('static', filename='javascript/pil_mitras_cs.js') }}"></script>

</body>
</html>
