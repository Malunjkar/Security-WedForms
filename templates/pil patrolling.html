<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Patrolling Observation Register</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pil patrolling.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>
    <!-- HEADER -->
    <header class="header-dashboard">

        <div class="hamburger-dashboard" id="hamburger"
            style="display:flex;align-items:center;gap:10px;cursor:pointer;">
            ☰
            <a href="{{ url_for('routes_bp.home') }}">
                <img src="{{ url_for('static', filename='img/logo.png') }}" class="logo-dashboard">
            </a>

        </div>
        <h2 style="text-align:center; position: sticky;">Patrolling Observation Register</h2>

        <div id="profileAvatar"
            style="display:flex;align-items:center;cursor:pointer;background:#fff;padding:6px 10px;border-radius:50px;box-shadow:0 2px 4px rgba(0,0,0,0.1);">

            <div id="profileInitials" style="background:#007bff;color:#fff;width:32px;height:32px;border-radius:50%;
                display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:1rem;">
                {{ (session.get('user') or {}).get('name','GU')[:2].upper() }}
            </div>

            <span id="username" style="margin-left:8px;font-weight:bold;color:#333;font-size:.9rem;">
                {{ (session.get('user') or {}).get('name','Guest User') }}
            </span>
        </div>

        <!-- Hamburger Menu -->
        <div id="hamburgerMenu" style="display:none;position:absolute;left:10px;top:60px;background:#fff;
            border-radius:8px;box-shadow:0 8px 16px rgba(0,0,0,0.1);
            overflow:hidden;min-width:220px;">
            <a href="{{ url_for('routes_bp.home') }}"
                style="display:block;padding:10px 14px;text-decoration:none;color:#333;">
                Forms Page
            </a>
        </div>

    </header>



    <div class="toolbar" style="justify-content: flex-end;">
        <div class="pagination">
            <button id="prevBtn" onclick="prevPage()">◀ Back</button>
            <span id="pageInfo"></span>
            <button id="nextBtn" onclick="nextPage()">Next ▶</button>
        </div>
    </div>


    <div class="table-wrapper">
        <table id="patrolTable">
            <thead>
                <tr>
                    <th>Sr. No</th>
                    <th>Location</th>
                    <th>Date</th>
                    <th>From Time</th>
                    <th>To Time</th>

                    <th>Condition of boundary wall / fencing / gates / infrastructure</th>
                    <th>Condition of patrolling pathway</th>
                    <th>Any Suspicious Movement</th>
                    <th>Wild vegetation</th>
                    <th>Illumination status</th>
                    <th>Workers working without valid work permit</th>
                    <th>Any unknown person without authorized entry permits</th>
                    <th>Any unattended office in unlocked condition (Silent Hours)</th>
                    <th>Any other observations</th>

                    <th>Remarks</th>
                    <th>Name of patrolling guard</th>
                    {% if user_role != 'admin' %}
                    <th class="action-col">Action</th>
                    {% endif %}
                </tr>
            </thead>

            <tbody></tbody>
        </table>
    </div>
    <div class="table-footer">

        {% if user_role != 'admin' %}
            <button class="btn-add" onclick="addRow()">Add Row</button>
            <button class="btn-save" id="saveBtn" onclick="saveTable()" style="display:none;">
  Save
</button>

        {% endif %}

        <button class="btn-download" onclick="downloadTable()">
            <i class="fa-solid fa-download"></i> Download
        </button>

    </div>



    <!-- ================= OK / NOT OK TEMPLATE ================= -->
    <template id="okNotOkTemplate">
        <select>
            <option value="OK">OK</option>
            <option value="NOT OK">NOT OK</option>
        </select>
    </template>


    <!-- ================= ADD ROW TEMPLATE ================= -->
    <template id="addRowTemplate">
        <tr data-new="true">
            <td class="sr-no"></td>
            <td class="location"></td>
            <td><input type="date"></td>
            <td><input type="time"></td>
            <td><input type="time"></td>

            <td class="ok"></td>
            <td class="ok"></td>
            <td class="ok"></td>
            <td class="ok"></td>
            <td class="ok"></td>
            <td class="ok"></td>
            <td class="ok"></td>
            <td class="ok"></td>
            <td class="ok"></td>

            <td><textarea></textarea></td>
            <td><input type="text"></td>
            <td class="action-col">
                <button class="icon-btn edit" onclick="editRow(this)">
                    <i class="fa-solid fa-pen"></i>
                </button>
                <button class="icon-btn delete" onclick="deleteRow(this)">
                    <i class="fa-solid fa-trash"></i>
                </button>
            </td>
        </tr>
    </template>

    <!-- ================= VIEW ROW TEMPLATE ================= -->
    <template id="viewRowTemplate">
        <tr>
            <td class="sr-no"></td>
            <td class="loc"></td>
            <td class="date"></td>
            <td class="from"></td>
            <td class="to"></td>

            <td class="c1"></td>
            <td class="c2"></td>
            <td class="c3"></td>
            <td class="c4"></td>
            <td class="c5"></td>
            <td class="c6"></td>
            <td class="c7"></td>
            <td class="c8"></td>
            <td class="c9"></td>

            <td class="remarks"></td>
            <td class="guard"></td>
            {% if user_role != 'admin' %}
            <td class="action-col">
                <button class="icon-btn edit" onclick="editRow(this)">
                    <i class="fa-solid fa-pen"></i>
                </button>
                <button class="icon-btn delete" onclick="deleteRow(this)">
                    <i class="fa-solid fa-trash"></i>
                </button>
            </td>
            {% endif %}
        </tr>
    </template>

    <script>
        const USER_LOCATION = "{{ user_location }}";
        const USER_ROLE = "{{ user_role }}";
    </script>
    <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="{{ url_for('static', filename='javascript/pil patrolling.js') }}"></script>

</body>

</html>