<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Visitor Declaration Slip</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/pil visitor slip.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>

<header class="header-dashboard">
  <div class="hamburger-dashboard">
    ☰
    <a href="{{ url_for('routes_bp.home') }}">
      <img src="{{ url_for('static', filename='img/logo.png') }}" class="logo-dashboard">
    </a>
  </div>

  <h2>Visitor Declaration Slip</h2>

  <div id="profileAvatar">
    <div id="profileInitials">
      {{ (session.get('user') or {}).get('name','GU')[:2].upper() }}
    </div>
    <span style="margin-left:8px;font-weight:bold;color:black;">
      {{ (session.get('user') or {}).get('name','Guest User') }}
    </span>
  </div>
</header>

<div class="container">

<!-- PAGINATION -->
<div class="toolbar" id="paginationBar">
  <div class="pagination">
    <button id="prevBtn" onclick="prevPage()">◀ Back</button>
    <span id="pageInfo"></span>
    <button id="nextBtn" onclick="nextPage()">Next ▶</button>
  </div>
</div>

<!-- ================= LIST VIEW ================= -->
<div id="listView">

<table id="masterTable">
<thead>
<tr>
  <th>Location</th>
  <th>Visitor Name</th>
  <th>Pass No</th>
  <th>Date / Time</th>

  {% if user_role != 'admin' %}
  <th>Action</th>
  {% endif %}

</tr>
</thead>
<tbody></tbody>

<!-- MASTER ROW TEMPLATE -->
<template id="visitorRowTemplate">
<tr>
  <td class="location"></td>
  <td class="visitor-name"></td>
  <td class="pass-no"></td>
  <td class="visit-datetime"></td>

  {% if user_role != 'admin' %}
  <td class="action-col">
    <button class="icon-btn edit">
      <i class="fa fa-pen"></i>
    </button>
    <button class="icon-btn delete">
      <i class="fa fa-trash"></i>
    </button>
    <button class="icon-btn download">
      <i class="fa-solid fa-download"></i>
    </button>
  </td>
  {% endif %}

</tr>
</template>

</table>

<div class="table-footer">

{% if user_role != 'admin' %}
<button class="btn-add" onclick="openAddForm()">Add Data</button>
{% endif %}

<button class="btn-download" onclick="downloadTable()">
  <i class="fa-solid fa-download"></i> Download
</button>

</div>

</div>

<!-- ================= STEP 1 ================= -->
<div id="step1" class="form-box">
<h3>Visitor Details</h3>

<div class="row">
  <div class="field">
    <label for="s_location">Location</label>
    <input id="s_location">
  </div>

  <div class="field">
    <label for="s_visitor_name">Visitor Name</label>
    <input id="s_visitor_name">
  </div>
</div>

<div class="row">
  <div class="field">
    <label for="s_visitor_pass_no">Visitor Pass No</label>
    <input id="s_visitor_pass_no">
  </div>

  <div class="field">
    <label for="s_whom_to_meet">Whom To Meet</label>
    <input id="s_whom_to_meet">
  </div>
</div>

<div class="row">
  <div class="field">
    <label for="dt_visit_datetime">Visit Date & Time</label>
    <input type="datetime-local" id="dt_visit_datetime">
  </div>
</div>

</div>

<!-- ================= STEP 2 ================= -->
<div id="step2" class="form-box">
<h3>Item Details</h3>

<div class="row">
  <div class="field field-small">
    <label for="item_desc">Item Code / Description</label>
    <input id="item_desc">
  </div>

  <div class="field field-xsmall">
    <label for="item_uom">UOM</label>
    <input id="item_uom">
  </div>

  <div class="field field-xsmall">
    <label for="item_qty">Quantity</label>
    <input id="item_qty" type="number">
  </div>
</div>

{% if user_role != 'admin' %}
<button onclick="addItem()">Add Item</button>
{% endif %}

<table id="itemTable">
<thead>
<tr>
  <th>Description</th>
  <th>UOM</th>
  <th>Qty</th>

  {% if user_role != 'admin' %}
  <th>Action</th>
  {% endif %}

</tr>
</thead>
<tbody></tbody>

<!-- ITEM ROW TEMPLATE -->
<template id="itemRowTemplate">
<tr>
  <td class="desc"></td>
  <td class="uom"></td>
  <td class="qty"></td>

  {% if user_role != 'admin' %}
  <td>
    <button class="icon-btn edit">
      <i class="fa fa-pen"></i>
    </button>
    <button class="icon-btn delete">
      <i class="fa fa-trash"></i>
    </button>
  </td>
  {% endif %}

</tr>
</template>

</table>

<br>

{% if user_role != 'admin' %}
<button class="btn-save" onclick="saveData()">Save</button>
{% endif %}

</div>

</div>

<script>
  const USER_LOCATION = "{{ user_location }}";
  const USER_ROLE = "{{ user_role }}";
</script>

<script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="{{ url_for('static', filename='javascript/visitor_declaration.js') }}"></script>

</body>
</html>
